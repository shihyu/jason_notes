<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>æ°¸è±shioaji - Jason Notes</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html">Jason Notes</a></li><li class="chapter-item expanded "><a href="../ubuntu/ubuntu_setup.html">Ubuntu</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ubuntu/command.html">Command</a></li><li class="chapter-item "><a href="../ubuntu/gcp.html">GCP ssh</a></li><li class="chapter-item "><a href="../ubuntu/wine.html">Wine</a></li></ol></li><li class="chapter-item expanded "><a href="../android/android.html">Android</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../android/install_sdk.html">SDK install</a></li><li class="chapter-item "><a href="../android/flutter.html">Flutter</a></li></ol></li><li class="chapter-item expanded "><a href="../tools/tools.html">Tools</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tools/asciinema.html">asciinema æŠŠçµ‚ç«¯æ“ä½œéŒ„è£½æˆ gif å‹•ç•«</a></li><li class="chapter-item "><a href="../tools/finmind.html">Finmind</a></li><li class="chapter-item "><a href="../tools/add-enter-and-exit-trace-for-your-function.html">addr2line</a></li><li class="chapter-item "><a href="../tools/cmake.html">cmake</a></li><li class="chapter-item "><a href="../tools/network.html">Network</a></li><li class="chapter-item "><a href="../tools/python-pycryptodome-aes-symmetric-encryption-tutorial-examples.html">å¯¦ä½œ AES å°ç¨±å¼åŠ å¯†</a></li></ol></li><li class="chapter-item expanded "><a href="../html/html.html">HTML</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../html/vue.html">Vue</a></li></ol></li><li class="chapter-item expanded "><a href="../vim/vim.html">Vim</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../vim/copilot.html">copilot</a></li><li class="chapter-item "><a href="../vim/tabnine.html">tabnine</a></li></ol></li><li class="chapter-item expanded "><a href="../gdb/gdb.html">Gdb</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gdb/å¸¸ç”¨æŒ‡ä»¤.html">å¸¸ç”¨æŒ‡ä»¤</a></li><li class="chapter-item "><a href="../gdb/jemalloc.html">jemalloc</a></li><li class="chapter-item "><a href="../gdb/graphs.html">graphs</a></li><li class="chapter-item "><a href="../gdb/rust-gdb.html">rust gdb</a></li><li class="chapter-item "><a href="../gdb/qemu-gdb-risc-v64.html">qemu-gdb-risc-v64-kernel</a></li><li class="chapter-item "><a href="../gdb/go-rust-gdb-debug.html">ä½¿ç”¨gdb è¿½è¹¤go/rustç¨‹å¼ç¢¼</a></li><li class="chapter-item "><a href="../gdb/gdb-function-trace-to-flowchart-guide.html">GDBå‡½æ•¸èª¿ç”¨è»Œè·¡åˆ†æèˆ‡æµç¨‹åœ–ç”Ÿæˆå®Œæ•´æŒ‡å—</a></li></ol></li><li class="chapter-item expanded "><a href="../c++/cpp.html">C++</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../c++/benchmark.html">benchmark</a></li><li class="chapter-item "><a href="../c++/ä¹˜ä»¥0.01å’Œé™¤ä»¥100å“ªå€‹å¿«.html">ä¹˜ä»¥ 0.01 å’Œé™¤ä»¥ 100 å“ªå€‹å¿«</a></li><li class="chapter-item "><a href="../c++/smart_pointer.html">Smart pointer</a></li><li class="chapter-item "><a href="../c++/l&rvalue.html">L&R value</a></li><li class="chapter-item "><a href="../c++/move.html">Move</a></li><li class="chapter-item "><a href="../c++/CAS.html">CAS</a></li><li class="chapter-item "><a href="../c++/HFT.html">HFT</a></li><li class="chapter-item "><a href="../c++/cpp_note.html">Note</a></li><li class="chapter-item "><a href="../c++/é«˜æ€§èƒ½ç¨‹å¼è¨­è¨ˆå¯¦æˆ°.html">é«˜æ€§èƒ½ç¨‹å¼è¨­è¨ˆå¯¦æˆ°</a></li><li class="chapter-item "><a href="../c++/å¦‚ä½•é«˜æ•ˆåœ°å„²å­˜ä¸¦æ“ä½œè¶…å¤§è¦æ¨¡.html">å¦‚ä½•é«˜æ•ˆåœ°å„²å­˜ä¸¦æ“ä½œè¶…å¤§è¦æ¨¡</a></li><li class="chapter-item "><a href="../c++/UC_CAPITAL.html">UC_CAPITAL</a></li><li class="chapter-item "><a href="../c++/cpp-smart-pointers-guide.html">unique_ptr vs shared_ptr</a></li><li class="chapter-item "><a href="../c++/cpp-move-semantics-guide.html">C++ Move èªæ„å®Œæ•´æŒ‡å—</a></li><li class="chapter-item "><a href="../c++/interview.html">interview</a></li></ol></li><li class="chapter-item expanded "><a href="../mojo/mojo.html">Mojo</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../mojo/mojo_crawler_guide.html">Mojo çˆ¬èŸ²å®Œæ•´æŒ‡å—</a></li></ol></li><li class="chapter-item expanded "><a href="../riscv/riscv.html">RISC-V</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../riscv/qemu_riscv_linux.html">QEMUä¸Šé‹è¡ŒRISV-V Linux</a></li><li class="chapter-item "><a href="../riscv/qemi_gdb.html">QEMU GDB</a></li><li class="chapter-item "><a href="../riscv/qemu_gdb_lab.html">Qemu Gdb Lab</a></li></ol></li><li class="chapter-item expanded "><a href="../centos/centos.html">CentOS</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../centos/tqdb_setup.html">TQDB å®‰è£ç´€éŒ„</a></li></ol></li><li class="chapter-item expanded "><a href="../ssh/ssh.html">SSH</a></li><li class="chapter-item expanded "><a href="../network/socket.html">Network</a></li><li class="chapter-item expanded "><a href="../docker/docker_helloworld.html">Docker</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../docker/docker.html">Docker åŸºæœ¬æ•™å­¸</a></li><li class="chapter-item "><a href="../docker/example.html">ç°¡å–®ç¯„ä¾‹</a></li><li class="chapter-item "><a href="../docker/creating-the-perfect-python-dockerfile.html">Perfect python dockerfile</a></li><li class="chapter-item "><a href="../docker/dockerfile-from-docker-image.html">ç”± Docker image åæ¨å…¶ Dockerfile</a></li><li class="chapter-item "><a href="../docker/python_connect_redis.html">Pythoné€£æ¥Redis</a></li><li class="chapter-item "><a href="../docker/command.html">Command</a></li><li class="chapter-item "><a href="../docker/docker_compose.html">Docker compose</a></li><li class="chapter-item "><a href="../docker/docker_compse_example.html">Docker compose example</a></li><li class="chapter-item "><a href="../docker/python_redis.html">Python-Redis</a></li><li class="chapter-item "><a href="../docker/redash.html">Redash</a></li><li class="chapter-item "><a href="../docker/clickhouse.html">ClickHouse</a></li><li class="chapter-item "><a href="../docker/clickhouse-setup.html">clickhouse-setup</a></li><li class="chapter-item "><a href="../docker/python_run_from_local.html">Docker run local</a></li><li class="chapter-item "><a href="../docker/redpanda.html">Redpanda</a></li><li class="chapter-item "><a href="../docker/gcc.html">é‹è¡Œæœ€æ–°ç‰ˆGCC</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/rust.html">Rust</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rust/note.html">Rustç­†è¨˜</a></li><li class="chapter-item "><a href="../rust/basic.html">Rust åŸºæœ¬æ•™å­¸</a></li><li class="chapter-item "><a href="../rust/ownership.html">Rust æ‰€æœ‰æ¬Šç³»çµ±</a></li><li class="chapter-item "><a href="../rust/lifetime.html">Rust ç”Ÿå‘½é€±æœŸ (Lifetime)</a></li><li class="chapter-item "><a href="../rust/type.html">Rust å‹åˆ¥ç³»çµ±</a></li><li class="chapter-item "><a href="../rust/rust_setup.html">Rust Tools</a></li><li class="chapter-item "><a href="../rust/polars.html">Polars</a></li><li class="chapter-item "><a href="../rust/rust_call_c.html">Rust call C</a></li><li class="chapter-item "><a href="../rust/pyo3.html">PyO3</a></li><li class="chapter-item "><a href="../rust/10-rust-an-introduction.html">çµ¦ C++ ä½¿ç”¨è€…çš„ Rust ç°¡ä»‹</a></li><li class="chapter-item "><a href="../rust/å¯è¦–åŒ–Rustå„è³‡æ–™çµæ§‹çš„è¨˜æ†¶é«”ä½ˆå±€.html">å¯è¦–åŒ–Rustå„è³‡æ–™çµæ§‹çš„è¨˜æ†¶é«”ä½ˆå±€</a></li><li class="chapter-item "><a href="../rust/rust_note.html">å­¸ç¿’é †åº</a></li><li class="chapter-item "><a href="../rust/overview.html">å¤§å±€è§€</a></li><li class="chapter-item "><a href="../rust/String.html">ç†è§£å­—ä¸²</a></li><li class="chapter-item "><a href="../rust/easy_rust.html">Easy Rust</a></li><li class="chapter-item "><a href="../rust/rust_easy.html">Rust æ–°æ‰‹</a></li><li class="chapter-item "><a href="../rust/module.html">Rust æ¨¡çµ„çµæ§‹</a></li><li class="chapter-item "><a href="../rust/rust_memory.html">Rustèˆ‡è¨˜æ†¶é«”</a></li><li class="chapter-item "><a href="../rust/rust_vs_cpp.html">Rust vs C++èªæ³•</a></li><li class="chapter-item "><a href="../rust/rust_file_format.html">Rust æª”æ¡ˆæ ¼å¼</a></li><li class="chapter-item "><a href="../rust/rust-an-introduction-in-oop.html">Rust OO</a></li><li class="chapter-item "><a href="../rust/rust-an-introduction-smart-pointer.html">Rust Pointer</a></li><li class="chapter-item "><a href="../rust/pointer.html">Pointer</a></li><li class="chapter-item "><a href="../rust/copy_trait.html">Copy Trait</a></li><li class="chapter-item "><a href="../rust/binary_lib.html">Rust å‡½æ•¸åº«/åŸ·è¡Œæª”</a></li><li class="chapter-item "><a href="../rust/reqwest.html">Reqwest</a></li><li class="chapter-item "><a href="../rust/print-function-name-dump-stack.html">å°å‡ºå‡½æ•¸åç¨±</a></li><li class="chapter-item "><a href="../rust/criterion.html">criterion</a></li><li class="chapter-item "><a href="../rust/Rustçš„ç²¾é«“.html">Rustçš„ç²¾é«“</a></li><li class="chapter-item "><a href="../rust/30å¤©æ·±å…¥æ·ºå‡ºRustç³»åˆ—.html">30å¤©æ·±å…¥æ·ºå‡ºRustç³»åˆ—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rust/30å¤©æ·±å…¥æ·ºå‡ºRustç³»åˆ—/rust_30_day.html">Rust 30 Day</a></li><li class="chapter-item "><a href="../rust/30å¤©æ·±å…¥æ·ºå‡ºRustç³»åˆ—/Move_Borrow_Ownership.html">è®Šæ•¸çš„æ‰€æœ‰æ¬Šèˆ‡å€Ÿå‡ºè®Šæ•¸</a></li><li class="chapter-item "><a href="../rust/30å¤©æ·±å…¥æ·ºå‡ºRustç³»åˆ—/Lifetime.html">Lifetimeï¼š Borrow çš„å­˜æ´»æ™‚é–“</a></li></ol></li><li class="chapter-item "><a href="../rust/cpp_vs_rust_comparison.html">C++ vs. Rust: å…¨é¢ç‰¹æ€§æ¯”è¼ƒ</a></li><li class="chapter-item "><a href="../rust/cpp-move-vs-rust-ownership.html">C++ Move èªç¾© vs Rust æ‰€æœ‰æ¬Šç³»çµ±çš„æ ¸å¿ƒå·®ç•°</a></li><li class="chapter-item "><a href="../rust/Rust-RESTful-API-å®Œæ•´é–‹ç™¼æŒ‡å—.html">Rust-RESTful-API-å®Œæ•´é–‹ç™¼æŒ‡å—</a></li><li class="chapter-item "><a href="../rust/Rust-self-Self-èˆ‡-C++-this-å°æ¯”æŒ‡å—.html">Rust-self-Self-èˆ‡-C++-this-å°æ¯”æŒ‡å—</a></li><li class="chapter-item "><a href="../rust/rust-derive-traits-comparison.html">Rust Derive Traits æ¯”è¼ƒï¼šè‡ªå‹•ç”Ÿæˆ vs æ‰‹å‹•å¯¦ä½œ</a></li><li class="chapter-item "><a href="../rust/rust_traits_explained.html">Rust Traits ç™½è©±è§£é‡‹ï¼šèˆ‡ C++ çš„æ¯”è¼ƒ</a></li><li class="chapter-item "><a href="../rust/rust_trait_impl_markdown.html">Rust ä¸­ trait å’Œ impl çš„å·®ç•°</a></li><li class="chapter-item "><a href="../rust/rust_cpp_comparison_md.html">Rust vs C++ è©³ç´°å°æ¯”æŒ‡å—</a></li><li class="chapter-item "><a href="../rust/rust_module_system_markdown.html">Rust æ¨¡çµ„ç³»çµ±å®Œæ•´æŒ‡å—</a></li><li class="chapter-item "><a href="../rust/ownership_vs_borrowing_guide.html">Rust æ“æœ‰æ¬Š vs å€Ÿç”¨ï¼šç”Ÿå‘½é€±æœŸå•é¡ŒæŒ‡å—ğŸ¦€</a></li><li class="chapter-item "><a href="../rust/rust_ownership_guide.html">Rust æ‰€æœ‰æ¬Šç³»çµ± - ç”Ÿæ´»åŒ–è©³è§£</a></li><li class="chapter-item "><a href="../rust/rust_ownership_complete_guide.html">Rust æ‰€æœ‰æ¬Šå®Œæ•´æŒ‡å— - å¾åŸºç¤åˆ°ç²¾é€š</a></li><li class="chapter-item "><a href="../rust/rust_memory_guide.html">Rust è¨˜æ†¶é«”é…ç½®æŒ‡å—ï¼šStack vs Heap</a></li><li class="chapter-item "><a href="../rust/rust_wrappers_guide.html">Rust åŒ…è£é¡å‹ç™½è©±æŒ‡å—ğŸ“¦</a></li></ol></li><li class="chapter-item expanded "><a href="../go/go.html">Go</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../go/note.html">Golang  Note</a></li><li class="chapter-item "><a href="../go/pytago.html">pytago</a></li><li class="chapter-item "><a href="../go/Goç·¨ç¨‹å¯¦æˆ°æ´¾åŸºç¤å…¥é–€.html">Goç·¨ç¨‹å¯¦æˆ°æ´¾åŸºç¤å…¥é–€</a></li><li class="chapter-item "><a href="../go/Goç·¨ç¨‹å¯¦æˆ°æ´¾Webé–‹ç™¼åŸºç¤.html">Goç·¨ç¨‹å¯¦æˆ°æ´¾Webé–‹ç™¼åŸºç¤</a></li><li class="chapter-item "><a href="../go/golang_debugger.html">Golang Deubgger</a></li><li class="chapter-item "><a href="../go/golang-go-module-tutorial.html">å¾ä¸€çŸ¥åŠè§£åˆ°ç•¥æ‡‚ Go modules</a></li><li class="chapter-item "><a href="../go/go_mod.html">Go modules</a></li><li class="chapter-item "><a href="../go/trace.html">Golangå¤§æ®ºå™¨ä¹‹è·Ÿè¹¤å‰–ætrace</a></li><li class="chapter-item "><a href="../go/Coroutine.html">è¡Œç¨‹ã€åŸ·è¡Œç·’ã€å”ç¨‹ï¼Œå‚»å‚»åˆ†å¾—æ¸…æ¥šï¼</a></li><li class="chapter-item "><a href="../go/goroutine-and-channel.html">Goä½µç™¼</a></li><li class="chapter-item "><a href="../go/websocket.html">Websocket</a></li><li class="chapter-item "><a href="../go/returning-pointer-from-a-function-in-go.html">Returning Pointer from a Function in Go</a></li><li class="chapter-item "><a href="../go/golang-memory-management.html">GC å…¨é¢è§£æ</a></li><li class="chapter-item "><a href="../go/golang-goroutine.html">Goroutine èˆ‡ GMP åŸç†å…¨é¢åˆ†æ</a></li><li class="chapter-item "><a href="../go/oo.html">OO</a></li><li class="chapter-item "><a href="../go/mutex-rwmutex.html">sync.Mutex å’Œ sync.RWMutex</a></li><li class="chapter-item "><a href="../go/interface.html">interface</a></li><li class="chapter-item "><a href="../go/example.html">Example</a></li><li class="chapter-item "><a href="../go/LiveKit.html">LiveKit</a></li></ol></li><li class="chapter-item expanded "><a href="../ml/ml.html">ML</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ml/pytorch.html">Pytorch</a></li><li class="chapter-item "><a href="../ml/pytorch_setup.html">Pytorch å®‰è£</a></li><li class="chapter-item "><a href="../ml/deap.html">Deap</a></li><li class="chapter-item "><a href="../ml/cudf.html">CUDF</a></li><li class="chapter-item "><a href="../ml/åˆæ¢åŸºå› æ¼”ç®—æ³•.html">åˆæ¢åŸºå› æ¼”ç®—æ³•-ç”¨ OneMax å•é¡Œç¤ºç¯„</a></li><li class="chapter-item "><a href="../ml/ç°¡å–®è§£é‡‹æ¢¯åº¦ä¸‹é™æ³•.html">ç°¡å–®è§£é‡‹æ¢¯åº¦ä¸‹é™æ³•</a></li><li class="chapter-item "><a href="../ml/æ¢¯åº¦ä¸‹é™æ³•_gradient_descent.html">æ¢¯åº¦ä¸‹é™æ³• gradient descent</a></li><li class="chapter-item "><a href="../ml/æ¢¯åº¦æœ€ä½³è§£ç›¸é—œç®—æ³•.html">æ¢¯åº¦æœ€ä½³è§£ç›¸é—œç®—æ³•</a></li><li class="chapter-item "><a href="../ml/åŸºæ–¼DEAPåº«çš„Pythoné€²åŒ–æ¼”ç®—æ³•å¾å…¥é–€åˆ°å…¥åœŸ.html">åŸºæ–¼DEAPåº«çš„Pythoné€²åŒ–æ¼”ç®—æ³•å¾å…¥é–€åˆ°å…¥åœŸ</a></li><li class="chapter-item "><a href="../ml/GA.html">GA</a></li><li class="chapter-item "><a href="../ml/XGBoost.html">XGBoost</a></li><li class="chapter-item "><a href="../ml/YOLO.html">YOLO</a></li><li class="chapter-item "><a href="../ml/yolov8æ‰‹å‹¢è­˜åˆ¥.html">YOLOv8æ‰‹å‹¢è­˜åˆ¥</a></li><li class="chapter-item "><a href="../ml/Roboflow.html">Roboflow</a></li></ol></li><li class="chapter-item expanded "><a href="../python/python.html">Python</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../python/Poetryå®Œå…¨å…¥é–€æŒ‡å—.html">Poetryå®Œå…¨å…¥é–€æŒ‡å—</a></li><li class="chapter-item "><a href="../python/æ­å»ºgRPCæœå‹™.html">æ­å»ºgRPCæœå‹™</a></li><li class="chapter-item "><a href="../python/python_debugger.html">Python Debugger</a></li><li class="chapter-item "><a href="../python/decorator.html">Python decorator</a></li><li class="chapter-item "><a href="../python/python-decorator.html">è£é£¾å™¨çœ‹é€™ä¸€ç¯‡å°±å¤ äº†</a></li><li class="chapter-item "><a href="../python/import-concept.html">import-concept</a></li><li class="chapter-item "><a href="../python/process_thread.html">Process/Threadå„ªç¼ºé»</a></li><li class="chapter-item "><a href="../python/processing_communcation.html">Processing é€šè¨Š</a></li><li class="chapter-item "><a href="../python/condition.html">Pythonä¸­çš„waitå’Œnotify</a></li><li class="chapter-item "><a href="../python/ç”Ÿç”¢è€…æ¶ˆè²»è€…æ¨¡å¼.html">ç”Ÿç”¢è€…æ¶ˆè²»è€…æ¨¡å¼</a></li><li class="chapter-item "><a href="../python/Loguru.html">Loguru</a></li><li class="chapter-item "><a href="../python/cython.html">Cython</a></li><li class="chapter-item "><a href="../python/WebSocket_reconnect.html">Python WebSocketé•·é€£æ¥å¿ƒè·³èˆ‡çŸ­é€£æ¥</a></li><li class="chapter-item "><a href="../python/bloomrpc.html">bloomrpc</a></li><li class="chapter-item "><a href="../python/concurrent.futures.html">Concurrent futures</a></li><li class="chapter-item "><a href="../python/schedule.html">ä»»å‹™èª¿åº¦</a></li><li class="chapter-item "><a href="../python/plot/plot.html">Plot</a></li><li class="chapter-item "><a href="../python/plot/dash.html">Dash</a></li><li class="chapter-item "><a href="../python/Rust_bindings_for_Python.html">Rust bindings for Python</a></li><li class="chapter-item "><a href="../python/pandas.html">Pandas</a></li><li class="chapter-item "><a href="../python/coroutine.html">Coroutine</a></li><li class="chapter-item "><a href="../python/finmind.html">FinMind</a></li><li class="chapter-item "><a href="../python/telegram_bot.html">Telegram Bot</a></li><li class="chapter-item "><a href="../python/python-different-ways-to-kill-a-thread.html">Different ways kill thread</a></li><li class="chapter-item "><a href="../python/websocket_client_server.html">Websocket client/server</a></li><li class="chapter-item "><a href="../python/poetry.html">å¾é›¶é–‹å§‹ä½¿ç”¨ Poetry</a></li><li class="chapter-item "><a href="../python/fil-memory-usage-profiler.html">Fil-memory-usage-profiler</a></li><li class="chapter-item "><a href="../python/plot.html">ç¹ªåœ–</a></li><li class="chapter-item expanded "><a href="../python/shioaji.html" class="active">æ°¸è±shioaji</a></li><li class="chapter-item "><a href="../python/other.html">Other</a></li></ol></li><li class="chapter-item expanded "><a href="../mermaid/mermaid.html">Mermaid</a></li><li class="chapter-item expanded "><a href="../linux_system/linux_system.html">Linux System</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../linux_system/1_day_socket.html">Socket</a></li><li class="chapter-item "><a href="../linux_system/cgroup.html">Cgroup</a></li><li class="chapter-item "><a href="../linux_system/perf.html">Perf</a></li><li class="chapter-item "><a href="../linux_system/è‡ªè£½Lib.html">build Lib</a></li><li class="chapter-item "><a href="../linux_system/performance.html">performance</a></li></ol></li><li class="chapter-item expanded "><a href="../strategy/bollmaker.html">Strategy</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../strategy/é€ å¸‚/market_market.html">é€ å¸‚</a></li><li class="chapter-item "><a href="../strategy/tw_futures.html">è‡ºæŒ‡</a></li><li class="chapter-item "><a href="../strategy/arbitrage.html">å¥—åˆ©</a></li><li class="chapter-item "><a href="../strategy/é…å°äº¤æ˜“.html">é…å°äº¤æ˜“</a></li><li class="chapter-item "><a href="../strategy/æµ·é¾œäº¤æ˜“.html">æµ·é¾œäº¤æ˜“</a></li><li class="chapter-item "><a href="../strategy/è‚¡æµ·ç­‹è‚‰äºº.html">è‚¡æµ·ç­‹è‚‰äºº</a></li><li class="chapter-item "><a href="../strategy/å¦‚ä½•é¿å…éæ“¬åˆ.html">å¦‚ä½•é¿å…éæ“¬åˆ</a></li><li class="chapter-item "><a href="../strategy/å¤šç©ºæ“ä½œè¡“.html">å¤šç©ºæ“ä½œè¡“</a></li><li class="chapter-item "><a href="../strategy/è³‡é‡‘æ§ç®¡æ‰æ˜¯ç‹é“.html">è³‡é‡‘æ§ç®¡æ‰æ˜¯ç‹é“</a></li><li class="chapter-item "><a href="../strategy/00713_00675Læ­£äºŒèœˆèš£ç­–ç•¥.html">æ­£äºŒèœˆèš£ç­–ç•¥</a></li><li class="chapter-item "><a href="../strategy/è³ªæŠ¼00713+æ­£äºŒ.html">è³ªæŠ¼00713+æ­£äºŒ</a></li><li class="chapter-item "><a href="../strategy/phcebus/phcebus.html">phcebus</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../strategy/phcebus/è²å¼æ€è€ƒ.html">è²å¼æ€è€ƒ</a></li><li class="chapter-item "><a href="../strategy/phcebus/è²·è‚¡3å¿ƒæ³•.html">è²·è‚¡3å¿ƒæ³•</a></li></ol></li><li class="chapter-item "><a href="../strategy/Option/option.html">é¸æ“‡æ¬Š</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../strategy/Option/option_note.html">Option note</a></li></ol></li><li class="chapter-item "><a href="../strategy/vectorbt.html">VectorBT</a></li><li class="chapter-item "><a href="../strategy/orderbook.html">Orderbook</a></li><li class="chapter-item "><a href="../strategy/é¸è‚¡æ¢ä»¶.html">é¸è‚¡æ¢ä»¶</a></li><li class="chapter-item "><a href="../strategy/å¦‚ä½•é€²å ´.html">å¦‚ä½•é€²å ´</a></li><li class="chapter-item "><a href="../strategy/å¦‚ä½•å‡ºå ´.html">å¦‚ä½•å‡ºå ´</a></li><li class="chapter-item "><a href="../strategy/å»ºå€‰åŠ ç¢¼.html">å»ºå€‰åŠ ç¢¼</a></li><li class="chapter-item "><a href="../strategy/DT.html">ç•¶æ²–</a></li><li class="chapter-item "><a href="../strategy/ç•¶æ²–åšç©º.html">ç•¶æ²–åšç©º</a></li><li class="chapter-item "><a href="../strategy/æŠ„åº•.html">æŠ„åº•</a></li><li class="chapter-item "><a href="../strategy/éº»é“æ˜/éº»é“æ˜.html">éº»é“æ˜</a></li><li class="chapter-item "><a href="../strategy/è³ºè´å¤§ç›¤çš„å‹•èƒ½æŠ•è³‡æ³•.html">è³ºè´å¤§ç›¤çš„å‹•èƒ½æŠ•è³‡æ³•</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../strategy/éº»é“æ˜/å‡çªç ´.html">å‡çªç ´</a></li></ol></li><li class="chapter-item "><a href="../strategy/å¥‡æ­£/å¥‡æ­£.html">å¥‡æ­£</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../strategy/å¥‡æ­£/è³‡é‡‘æ§ç®¡èˆ‡è©¦å–®ç­–ç•¥.html">è³‡é‡‘æ§ç®¡èˆ‡è©¦å–®ç­–ç•¥</a></li><li class="chapter-item "><a href="../strategy/å¥‡æ­£/å¦‚ä½•å‡ºå ´.html">å¦‚ä½•å‡ºå ´</a></li></ol></li><li class="chapter-item "><a href="../strategy/ptt_stock/a0808996.html">PTT Stock</a></li><li class="chapter-item "><a href="../strategy/Book/JG.html">JG</a></li><li class="chapter-item "><a href="../strategy/bnf.html">BNF</a></li><li class="chapter-item "><a href="../strategy/cis.html">CIS</a></li><li class="chapter-item "><a href="../strategy/GA.html">GA</a></li><li class="chapter-item "><a href="../strategy/stock.html">Stock</a></li><li class="chapter-item "><a href="../strategy/note.html">Resource</a></li><li class="chapter-item "><a href="../strategy/nansen.html">Nansen</a></li><li class="chapter-item "><a href="../strategy/example.html">Example</a></li><li class="chapter-item "><a href="../strategy/other.html">Other</a></li><li class="chapter-item "><a href="../strategy/sample.html">Sample</a></li><li class="chapter-item "><a href="../strategy/shioaji.html">shioaji æ¨¡æ“¬</a></li><li class="chapter-item "><a href="../strategy/grid.html">Grid</a></li><li class="chapter-item "><a href="../strategy/pine-script.html">pine-script</a></li><li class="chapter-item "><a href="../strategy/æ‹¾äººç‰™æ…§.html">æ‹¾äººç‰™æ…§</a></li><li class="chapter-item "><a href="../strategy/sharpe_ratio.html">å¤æ™®å€¼</a></li><li class="chapter-item "><a href="../strategy/display_mae_mfe_analysis.html">MAE&MFEåˆ†æ</a></li><li class="chapter-item "><a href="../strategy/æµ·é¾œæŠ•è³‡æ³•å‰‡.html">æµ·é¾œæŠ•è³‡æ³•å‰‡</a></li><li class="chapter-item "><a href="../strategy/edge-ratio-follow-application.html">å½ˆæ€§é€²å‡ºå ´çš„åˆ¤æ–·</a></li><li class="chapter-item "><a href="../strategy/ä¸‰å¿ƒæ³•é †å‹¢æ“ä½œé™³æ—å…ƒ10å¹´è³‡ç”¢ç¿»10å€.html">ä¸‰å¿ƒæ³•é †å‹¢æ“ä½œé™³æ—å…ƒ10å¹´è³‡ç”¢ç¿»10å€</a></li><li class="chapter-item "><a href="../strategy/Jump.html">JUMP</a></li><li class="chapter-item "><a href="../strategy/å¼µæ¾å…æŠ•è³‡å¿ƒæ³•.html">å¼µå…æŠ•è³‡å¿ƒæ³•</a></li><li class="chapter-item "><a href="../strategy/vectorbt_é…å°.html">vectorbt é…å°</a></li><li class="chapter-item "><a href="../strategy/äº¤æ˜“çš„è¡Œç‚ºèˆ‡æ€ç¶­åˆ†äº«.html">äº¤æ˜“çš„è¡Œç‚ºèˆ‡æ€ç¶­åˆ†äº«</a></li><li class="chapter-item "><a href="../strategy/æŠ•è³‡æŠ•æ©Ÿçš„è§€å¿µèˆ‡å¿ƒå¾—åˆ†äº«.html">æŠ•è³‡æŠ•æ©Ÿçš„è§€å¿µèˆ‡å¿ƒå¾—åˆ†äº«</a></li><li class="chapter-item "><a href="../strategy/finlab.html">Finlab</a></li><li class="chapter-item "><a href="../strategy/backtrader/basis.html">Backtrader</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../strategy/backtrader/Pythonå›æ¸¬æ¡†æ¶ä¸€Backtraderä»‹ç´¹.html">Pythonå›æ¸¬æ¡†æ¶ä¸€Backtraderä»‹ç´¹</a></li><li class="chapter-item "><a href="../strategy/backtrader/Pythonå›æ¸¬æ¡†æ¶äºŒå®šæœŸå®šé¡æŠ•è³‡.html">Python å›æ¸¬æ¡†æ¶ï¼ˆäºŒï¼‰å®šæœŸå®šé¡æŠ•è³‡</a></li><li class="chapter-item "><a href="../strategy/backtrader/Pythonå›æ¸¬æ¡†æ¶ä¸‰æŠ€è¡“æŒ‡æ¨™.html">Python å›æ¸¬æ¡†æ¶ï¼ˆä¸‰ï¼‰æŠ€è¡“æŒ‡æ¨™</a></li><li class="chapter-item "><a href="../strategy/backtrader/Pythonå›æ¸¬æ¡†æ¶å››CrossOverå’ŒSignal.html">Python å›æ¸¬æ¡†æ¶ï¼ˆå››ï¼‰CrossOver å’Œ Signal</a></li><li class="chapter-item "><a href="../strategy/backtrader/Pythonå›æ¸¬æ¡†æ¶äº”Sizer.html">Python å›æ¸¬æ¡†æ¶ï¼ˆäº”ï¼‰Sizer</a></li><li class="chapter-item "><a href="../strategy/backtrader/Pythonå›æ¸¬æ¡†æ¶å…­Analyzers.html">Python å›æ¸¬æ¡†æ¶ï¼ˆå…­ï¼‰Analyzers</a></li><li class="chapter-item "><a href="../strategy/backtrader/å¤šè‚¡çµ„åˆæ“ä½œç­–ç•¥.html">å¤šè‚¡çµ„åˆæ“ä½œ</a></li><li class="chapter-item "><a href="../strategy/backtrader/å‡ç·šäº¤å‰ç­–ç•¥.html">å‡ç·šäº¤å‰ç­–ç•¥</a></li><li class="chapter-item "><a href="../strategy/backtrader/å”å¥‡å®‰é€šé“ç­–ç•¥.html">å”å¥‡å®‰é€šé“ç­–ç•¥</a></li><li class="chapter-item "><a href="../strategy/backtrader/Sizersæ¨¡çµ„.html">Sizersæ¨¡çµ„</a></li><li class="chapter-item "><a href="../strategy/backtrader/Observersæ¨¡çµ„.html">Observersæ¨¡çµ„</a></li><li class="chapter-item "><a href="../strategy/backtrader/Pyfolio.html">Pyfolio</a></li><li class="chapter-item "><a href="../strategy/backtrader/Sample.html">Sample</a></li><li class="chapter-item "><a href="../strategy/backtrader/performance.html">Performance</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../mq/kafka.html">MQ</a></li><li class="chapter-item expanded "><a href="../mq/kafka-python.html">Kafkaçš„é€šä¿—ç¸½çµ</a></li><li class="chapter-item expanded "><a href="../database/database.html">Database</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../database/redis.html">Redis</a></li><li class="chapter-item "><a href="../database/hash.html">Redis Hash</a></li><li class="chapter-item "><a href="../database/clickhouse.html">ClickHouse</a></li><li class="chapter-item "><a href="../database/dolphin.html">Dolphin</a></li><li class="chapter-item "><a href="../database/sqlite.html">Sqlite</a></li></ol></li><li class="chapter-item expanded "><a href="../cryptotrade/cryptotrade.html">CryptoTrade</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cryptotrade/binance/binance.html">Binance</a></li><li class="chapter-item "><a href="../cryptotrade/binance/oco.html">å¦‚ä½•å°‡OCOè¨‚å–®ç™¼é€åˆ°Binance</a></li></ol></li><li class="chapter-item expanded "><a href="../git/git.html">Git</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../git/git-remove-commited-files.html">git-remove-commited-files</a></li><li class="chapter-item "><a href="../git/cheat-sheet.html">Git å¸¸ç”¨</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jason Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shihyu/jason_notes" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="å–å¾—ç›®å‰é€±é¸æ“‡ä»£è™Ÿ"><a class="header" href="#å–å¾—ç›®å‰é€±é¸æ“‡ä»£è™Ÿ">å–å¾—ç›®å‰é€±é¸æ“‡ä»£è™Ÿ</a></h2>
<pre><code class="language-python">from multiprocessing import Process, Queue
from shioaji.contracts import Contract
from shioaji import Exchange
from time import sleep
from line_notify import LineNotify

import sys
import platform
import signal
import datetime
import shioaji as sj
import os
import json
import pandas as pd


token_list = {

}


def line_notify(message):
    for _, token in token_list.items():
        LineNotify(token).send(message)


class Watcher:
    def __init__(self):
        self.child = os.fork()
        if self.child == 0:
            return
        else:
            self.watch()

    def watch(self):
        try:
            os.wait()
        except KeyboardInterrupt:
            self.kill()
        sys.exit()

    def kill(self):
        try:
            print("kill")
            os.kill(self.child, signal.SIGKILL)
        except OSError:
            pass


def get_previous_wednesday():
    today = datetime.datetime.today()
    wednesday = (
        today - datetime.timedelta(days=today.weekday()) + datetime.timedelta(days=2)
    )
    previous_wednesday = wednesday - datetime.timedelta(days=7)
    return previous_wednesday.date()


def get_this_week_wednesday():
    today = datetime.datetime.today()
    wednesday = (today + datetime.timedelta(days=(2 - today.weekday()))).date()
    return wednesday


def get_next_week_wednesday():
    today = datetime.datetime.today()
    wednesday = (today + datetime.timedelta(days=(2 - today.weekday() + 7))).date()
    return wednesday


def get_option_symbol(api):
    for option in api.Contracts.Options:
        for contract in option:
            if "TX" in contract.category:
                now = datetime.datetime.now()
                wednesday_time = get_this_week_wednesday()
                wednesday_time = datetime.datetime.combine(
                    wednesday_time, datetime.datetime.min.time()
                ) + datetime.timedelta(
                    hours=14
                )  # å› ç‚ºç¨‹å¼æ˜¯14:50å•Ÿå‹•è¨ˆç®—æ‰€ä»¥æ”¹è¨­å®š14:00
                # æ ¹æ“šç•¶å‰æ™‚é–“åˆ¤æ–·æ˜¯å¦åœ¨æ˜ŸæœŸä¸‰ 15:00ä¹‹å‰ã€‚å¦‚æœåœ¨æ­¤æ™‚é–“ä¹‹å‰ï¼Œå‰‡åˆ—å°ä¸Šé€±ä¸‰å’Œæœ¬é€±ä¸‰çš„æ—¥æœŸï¼›å¦å‰‡åˆ—å°æœ¬é€±ä¸‰å’Œä¸‹é€±ä¸‰çš„æ—¥æœŸï¼š
                if now &lt; wednesday_time:
                    if datetime.datetime.strptime(
                        contract.update_date, "%Y/%m/%d"
                    ).date() &gt;= get_previous_wednesday() and contract.delivery_date == get_this_week_wednesday().strftime(
                        "%Y/%m/%d"
                    ):
                        print(
                            contract.symbol,
                            contract.name,
                            contract.update_date,
                            contract.delivery_date,
                        )
                        return contract.symbol
                else:
                    if datetime.datetime.strptime(
                        contract.update_date, "%Y/%m/%d"
                    ).date() &gt;= get_this_week_wednesday() and contract.delivery_date == get_next_week_wednesday().strftime(
                        "%Y/%m/%d"
                    ):
                        print(
                            contract.symbol,
                            contract.name,
                            contract.update_date,
                            contract.delivery_date,
                        )
                        return contract.symbol


if __name__ == "__main__":
    if platform.system().lower() == "linux":
        Watcher()

    with open(os.environ["HOME"] + "/.mybin/shioaji_token.txt", "r") as f:
        api = sj.Shioaji()
        kw_login = json.loads(f.read())
        print(kw_login)
        api.login(**kw_login, contracts_timeout=300000)
        # api.fetch_contracts(contract_download=True)
        print(get_option_symbol(api))
        api.logout()

</code></pre>
<h2 id="å–å¾—é€±é¸é€±ä¸‰æ›ç´„1500-å¾Œå„å±¥ç´„åƒ¹ç¬¬ä¸€ç­†æˆäº¤åƒ¹"><a class="header" href="#å–å¾—é€±é¸é€±ä¸‰æ›ç´„1500-å¾Œå„å±¥ç´„åƒ¹ç¬¬ä¸€ç­†æˆäº¤åƒ¹">å–å¾—é€±é¸é€±ä¸‰æ›ç´„15:00 å¾Œå„å±¥ç´„åƒ¹ç¬¬ä¸€ç­†æˆäº¤åƒ¹</a></h2>
<pre><code class="language-python">import platform
import shioaji as sj
import datetime as dt
import pandas as pd
import signal
import os
import sys
import json

from line_notify import LineNotify


class Watcher:
    def __init__(self):
        self.child = os.fork()
        if self.child == 0:
            return
        else:
            self.watch()

    def watch(self):
        try:
            os.wait()
        except KeyboardInterrupt:
            self.kill()
        sys.exit()

    def kill(self):
        try:
            print("kill")
            os.kill(self.child, signal.SIGKILL)
        except OSError:
            pass


# å–å¾—å¤§è‡ºæœŸè²¨é–‹ç›¤åƒ¹
def getOpenPrice(api, year, month, day, open_time):
    try:
        TXF = (
            sorted([x for x in dir(api.Contracts.Futures.TXF) if x.startswith("TXF")])
        )[0]
        date = dt.datetime(year, month, day).strftime("%Y-%m-%d")
        kbars = api.kbars(api.Contracts.Futures.TXF[TXF], date)
        df = pd.DataFrame({**kbars})
        if not df.empty:
            df.ts = pd.to_datetime(df.ts)
            df.set_index("ts", inplace=True)
            return df.iloc[df.index.get_loc(open_time, method="nearest")]["Open"]
        else:
            return None
    except:
        return None


def getOptionsDealts(api, OP, year, month, day):
    date = dt.datetime(year, month, day).strftime("%Y-%m-%d")
    try:
        # print(OP[:3], OP, date)
        ticks = api.ticks(api.Contracts.Options[OP[:3]][OP], date)
        df = pd.DataFrame({**ticks})
        if df.empty:
            return pd.DataFrame()
        df.ts = pd.to_datetime(df.ts)
        df["OP"] = OP
    except:
        # print(OP)
        return pd.DataFrame()
    return df


# {1: buy deal, 2: sell deal, 0: can't judge}
def set_tick_type(df):
    if df["close"] == df["bid_price"]:
        return 1
    elif df["close"] == df["ask_price"]:
        return 2
    else:
        return 0


def get_options_contracts(api):
    option_contracts = {"week": [], "month": []}
    symbols = sorted([x.symbol for x in api.Contracts.Options.TXO])
    near_option_symbol = symbols[0][3:9]

    for option in api.Contracts.Options:
        for contract in option:
            if "TX" in contract.category and near_option_symbol in contract.symbol:
                if contract.category == "TXO":
                    option_contracts["month"].append(contract)
                else:
                    option_contracts["week"].append(contract)

    return option_contracts


def main():
    api = sj.Shioaji(simulation=False)
    with open(os.environ["HOME"] + "/.mybin/shioaji_token.txt", "r") as f:
        # with open(os.environ["HOME"] + "/.mybin/login.txt", "r") as f:
        kw_login = json.loads(f.read())
        api.login(**kw_login, contracts_timeout=300000)

    options_contracts = get_options_contracts(api)

    week_options = []
    for c in options_contracts["week"]:
        week_options.append(c["symbol"])

    today = dt.date.today()
    last_thursday = today - dt.timedelta(days=(today.weekday() + 1) % 7 + 3)

    first_row_list = []
    for OP in week_options:
        df = getOptionsDealts(
            api, OP, last_thursday.year, last_thursday.month, last_thursday.day
        )
        if not df.empty:
            columns = [
                "OP",
                "ts",
                "close",
                "volume",
                "ask_price",
                "ask_volume",
                "bid_price",
                "bid_volume",
            ]
            df = df[columns]
            df = df.assign(tick_type=df.apply(set_tick_type, axis=1))
            # å‡è¨­æ—¥æœŸæ™‚é–“æ¬„ä½åç¨±ç‚º 'datetime'
            df["ts"] = pd.to_datetime(df["ts"])  # å°‡æ¬„ä½è½‰æ›ç‚ºæ—¥æœŸæ™‚é–“æ ¼å¼
            # é¸æ“‡15:00ä¹‹å¾Œçš„æ™‚é–“
            df = df[df["ts"].dt.hour &gt;= 15]
            df["OP_close"] = df["OP"].str.extract(r"(\d{5})[PC]")
            df["OP_close"] = df["OP_close"].astype(int)
            df["OP_close"] = df["OP_close"] + df["close"]

            if not df.empty:
                df.reset_index(drop=True, inplace=True)
                first_row_list.append(df.iloc[0])
                # print(df, df.iloc[0], type(df.iloc[0]))

    df_new = pd.DataFrame(
        first_row_list,
        columns=[
            "OP",
            "ts",
            "close",
            "volume",
            "ask_price",
            "ask_volume",
            "bid_price",
            "bid_volume",
            "tick_type",
            "OP_close",
        ],
    )
    df_new.sort_values("OP", ascending=False, inplace=True)
    df_new = df_new.reset_index(drop=True)
    print(df_new)
    api.logout()


if __name__ == "__main__":
    if platform.system().lower() == "linux":
        Watcher()
    main()
</code></pre>
<h3 id="å–å¾—æœ€è¿‘æœŸè²¨åˆç´„ä»£è™Ÿ"><a class="header" href="#å–å¾—æœ€è¿‘æœŸè²¨åˆç´„ä»£è™Ÿ">å–å¾—æœ€è¿‘æœŸè²¨åˆç´„ä»£è™Ÿ</a></h3>
<pre><code class="language-python">def getOpenPrice(api, year, month, day, open_time):
    TXF = (sorted([x for x in dir(api.Contracts.Futures.TXF) if x.startswith('TXF')]))[0]
    date = dt.datetime(year, month, day).strftime("%Y-%m-%d")
    kbars = api.kbars(api.Contracts.Futures.TXF[TXF], date)
    df = pd.DataFrame({**kbars})
    df.ts = pd.to_datetime(df.ts)
    df.set_index("ts", inplace=True)
    return df.iloc[df.index.get_loc(open_time, method="nearest")]["Open"]
</code></pre>
<h3 id="å–å¾—é€±è·Ÿæœˆé¸æ“‡æ¬Šåˆç´„"><a class="header" href="#å–å¾—é€±è·Ÿæœˆé¸æ“‡æ¬Šåˆç´„">å–å¾—é€±è·Ÿæœˆé¸æ“‡æ¬Šåˆç´„</a></h3>
<pre><code class="language-python">import shioaji as sj
import os
import json


def get_options_contracts(api):
    option_contracts = {"week": [], "month": []}
    symbols = sorted([x.symbol for x in api.Contracts.Options.TXO])
    near_option_symbol = symbols[0][3:9]

    for option in api.Contracts.Options:
        for contract in option:
            if "TX" in contract.category and near_option_symbol in contract.symbol:
                if contract.category == "TXO":
                    option_contracts["month"].append(contract)
                else:
                    option_contracts["week"].append(contract)

    return option_contracts


if __name__ == "__main__":
    with open(os.environ["HOME"] + "/.mybin/shioaji_token.txt", "r") as f:
        api = sj.Shioaji()
        kw_login = json.loads(f.read())
        api.login(**kw_login, contracts_timeout=300000)
        options_contracts = get_options_contracts(api)
        print("Month option contracts:", options_contracts["month"])
        print("Week option contracts:", options_contracts["week"])
</code></pre>
<h3 id="ä½¿ç”¨-token-ç‰ˆæœ¬"><a class="header" href="#ä½¿ç”¨-token-ç‰ˆæœ¬">ä½¿ç”¨ Token ç‰ˆæœ¬</a></h3>
<pre><code class="language-python">#
#
# ç”¨ä¾†è¨˜éŒ„ é¸æ“‡æ¬Šçš„ tickå’Œå ±åƒ¹
#
#

from multiprocessing import Process, Queue
from shioaji.contracts import Contract
from shioaji import contracts
from time import sleep


import datetime
import shioaji as sj
import os
import json
import queue


class shioaji_proxy:
    def __init__(self, queue: Queue, bool_call: bool, bool_TSE: bool):
        self.queue = queue
        self.bool_call = bool_call

        with open(os.environ["HOME"] + "/.mybin/shioaji_token.txt", "r") as f:
            self.api = sj.Shioaji()
            kw_login = json.loads(f.read())
            self.api.login(**kw_login, contracts_timeout=300000)

        # ä¹‹å¾Œæ”¹ç‰ˆæœƒä¿®æ­£å°±ä¸éœ€è¦
        # self.api.fetch_contracts(contract_download=True)

        self.api.quote.set_on_bidask_fop_v1_callback(self.quote_callback)
        self.api.quote.set_on_tick_fop_v1_callback(self.quote_callback)
        option_contracts = self.get_options_contracts()

        c: Contract
        for c in option_contracts["week"]:
            if c.symbol[-1] == ("C" if self.bool_call else "P"):
                print(c)
                self.api.quote.subscribe(
                    c,
                    quote_type=sj.constant.QuoteType.Tick,
                    # version=sj.constant.QuoteVersion.v1,
                )
                self.api.quote.subscribe(
                    c,
                    quote_type=sj.constant.QuoteType.BidAsk,
                    # version=sj.constant.QuoteVersion.v1,
                )

        # self.contract: Contract = self.api.Contracts.Options.TXO.TXO202206016600C if bool_call else self.api.Contracts.Options.TXO.TXO202206016600P

        # if bool_TSE:
        #    self.api.quote.subscribe(
        #        self.api.Contracts.Indexs.TSE.TSE001,
        #        quote_type=sj.constant.QuoteType.Tick,
        #    )

    def get_options_contracts(self):
        option_contracts = {"week": [], "month": []}
        symbols = sorted([x.symbol for x in self.api.Contracts.Options.TXO])
        near_option_symbol = symbols[0][3:9]

        for option in self.api.Contracts.Options:
            for contract in option:
                if "TX" in contract.category and near_option_symbol in contract.symbol:
                    if contract.category == "TXO":
                        option_contracts["month"].append(contract)
                    else:
                        option_contracts["week"].append(contract)

        return option_contracts

    def quote_callback(self, topic: str, quote: dict):
        # print(topic, quote)
        self.queue.put((topic, quote))


def shioaji_subscriber(queue, bool_call, bool_TSE):
    proxy = shioaji_proxy(queue, bool_call, bool_TSE)

    while True:
        sleep(1)
        queue.put(f"{proxy} {datetime.datetime.now()}")


if __name__ == "__main__":
    q = Queue()  # æ–¼ä¸»é€²ç¨‹å‰µå»ºéšŠåˆ—ç‰©ä»¶
    process_list = []
    print("main queue id: %d" % id(q))

    proc = Process(target=shioaji_subscriber, args=(q, True, True))
    process_list.append(proc)
    proc.start()
    proc = Process(target=shioaji_subscriber, args=(q, False, False))
    process_list.append(proc)
    proc.start()

    bool_AM = (
        True
        if datetime.datetime.now().time() &lt; datetime.time(hour=12, minute=0)
        else False
    )

    with open(
        f'TXO-{datetime.datetime.now().date()}-{"AM" if bool_AM else "PM"}.txt', "w+"
    ) as fp:
        ret_count = 0
        while True:
            try:
                ret = q.get(timeout=1)
            except queue.Empty:
                print(datetime.datetime.now())
            else:
                fp.write(f"{datetime.datetime.now()}\t{ret[0]}\t{ret[1]}\n")
                ret_count += 1

            # Check if we have written 100 records, then write to file and reset count
            if ret_count == 100:
                fp.flush()  # flush the file buffer to disk
                ret_count = 0

            # Check if current time is between 13:46 and 14:00, or between 5:01 and 5:10, then exit loop
            if (
                datetime.time(hour=13, minute=46)
                &lt; datetime.datetime.now().time()
                &lt; datetime.time(hour=14, minute=0)
            ) or (
                datetime.time(hour=5, minute=1)
                &lt; datetime.datetime.now().time()
                &lt; datetime.time(hour=5, minute=10)
            ):
                break

    for p in process_list:
        p.terminate()
        p.join()
        p.close()
        print(f"{p} joined")
</code></pre>
<h3 id="ç”¨ä¾†è¨˜éŒ„-é¸æ“‡æ¬Šçš„-tickå’Œå ±åƒ¹"><a class="header" href="#ç”¨ä¾†è¨˜éŒ„-é¸æ“‡æ¬Šçš„-tickå’Œå ±åƒ¹">ç”¨ä¾†è¨˜éŒ„ é¸æ“‡æ¬Šçš„ tickå’Œå ±åƒ¹</a></h3>
<pre><code class="language-python">from multiprocessing import Process, Queue

import datetime
import shioaji as sj
from shioaji import contracts
from shioaji.contracts import Contract
import os
import json
from time import sleep
import queue


class shioaji_proxy:
    def __init__(self, queue: Queue, bool_call: bool, bool_TSE: bool):
        self.queue = queue
        self.bool_call = bool_call

        with open(os.environ["HOME"] + "/.mybin/login.txt", "r") as f:
            self.api = sj.Shioaji()
            kw_login = json.loads(f.read())
            self.api.login(**kw_login, contracts_timeout=300000)

        self.api.quote.set_quote_callback(self.quote_callback)

        symbols = []
        for x in self.api.Contracts.Options.TXO:
            symbols.append(x.symbol)
        symbols.sort()
        str_option_near = symbols[0][:9]

        contracts = []
        for x in self.api.Contracts.Options.TXO:
            if x.symbol.startswith(str_option_near):
                contracts.append(x)

        c: Contract
        for c in contracts:
            if c.symbol[-1] == ("C" if self.bool_call else "P"):
                self.api.quote.subscribe(c, quote_type=sj.constant.QuoteType.Tick)
                self.api.quote.subscribe(c, quote_type=sj.constant.QuoteType.BidAsk)

        # self.contract: Contract = self.api.Contracts.Options.TXO.TXO202206016600C if bool_call else self.api.Contracts.Options.TXO.TXO202206016600P

        if bool_TSE:
            self.api.quote.subscribe(
                self.api.Contracts.Indexs.TSE.TSE001,
                quote_type=sj.constant.QuoteType.Tick,
            )

    def quote_callback(self, topic: str, quote: dict):
        # print(topic, quote)
        self.queue.put((topic, quote))


def shioaji_subscriber(queue, bool_call, bool_TSE):
    proxy = shioaji_proxy(queue, bool_call, bool_TSE)

    while True:
        sleep(1)
        queue.put(f"{proxy} {datetime.datetime.now()}")


if __name__ == "__main__":
    q = Queue()  # æ–¼ä¸»é€²ç¨‹å‰µå»ºéšŠåˆ—ç‰©ä»¶
    process_list = []
    print("main queue id: %d" % id(q))

    # shioaji_subscriber(q, True, True)

    proc = Process(target=shioaji_subscriber, args=(q, True, True))
    process_list.append(proc)
    proc.start()
    proc = Process(target=shioaji_subscriber, args=(q, False, False))
    process_list.append(proc)
    proc.start()

    bool_AM = (
        True
        if datetime.datetime.now().time() &lt; datetime.time(hour=12, minute=0)
        else False
    )

    with open(
        f'TXO-{datetime.datetime.now().date()}-{"AM" if bool_AM else "PM"}.txt', "w+"
    ) as fp:
        while True:
            try:
                ret = q.get(timeout=1)
            except queue.Empty:
                pass
                print(datetime.datetime.now())
            else:
                # print(ret)
                fp.write(f"{datetime.datetime.now()}\t{ret[0]}\t{ret[1]}\n")

            if (
                datetime.time(hour=13, minute=46)
                &lt; datetime.datetime.now().time()
                &lt; datetime.time(hour=14, minute=0)
            ):
                break

            if (
                datetime.time(hour=5, minute=1)
                &lt; datetime.datetime.now().time()
                &lt; datetime.time(hour=5, minute=10)
            ):
                break

    for p in process_list:
        p.terminate()
        p.join()
        p.close()
        print(f"{p} joined")
</code></pre>
<h2 id="é¸æ“‡æ¬Šæœ€è¿‘åˆç´„æ’åº"><a class="header" href="#é¸æ“‡æ¬Šæœ€è¿‘åˆç´„æ’åº">é¸æ“‡æ¬Šæœ€è¿‘åˆç´„æ’åº</a></h2>
<pre><code class="language-python">import shioaji as sj
import os
import json

with open(os.environ["HOME"] + "/.mybin/login.txt", "r") as f:
    api = sj.Shioaji()
    kw_login = json.loads(f.read())
    api.login(**kw_login, contracts_timeout=300000)

symbols = []
for x in api.Contracts.Options.TXO:
    symbols.append(x.symbol)

symbols.sort()
str_option_near = symbols[0][:9]

contracts = []
for x in api.Contracts.Options.TXO:
    if x.symbol.startswith(str_option_near):
        contracts.append(x)

for c in contracts:
    print(c, c.symbol)
    # if c.symbol[-1] == ("C" if bool_call else "P"):
    # print(x)
</code></pre>
<pre><code class="language-python">from shioaji import TickSTKv1, TickFOPv1, BidAskSTKv1, BidAskFOPv1, Exchange


def order_callback(stat, msg: dict):
    print(f"\n\033[1;33morder_callback: {stat} {msg}\033[0m\n")


def event_callback(resp_code, event, info, event_str):
    print(
        f"\n\033[1;33mevent_callback: {resp_code} {event} {info} {event_str}\033[0m\n"
    )


def quote_callback(topic: str, quote: dict):
    print(f"\n\033[1;33mquote_callback: {topic} {quote}\033[0m\n")


def stk_tick_callback_v1(exchange: Exchange, tick: TickSTKv1):
    print(f"stk_tick_callback_v1: {exchange} {tick}")
    print(json.dumps(tick))


def stk_bidask_callback_v1(exchange: Exchange, bidask: BidAskSTKv1):
    print(f"stk_bidask_callback_v1: {exchange} {bidask}")


# {'code': 'TXFG2', 'datetime': '2022-06-23T21:52:32.489000', 'bid_total_vol': 74, 'ask_total_vol': 44, 'bid_price': ['14933', '14932', '14931', '14930', '14929'], 'bid_volume': [3, 11, 20, 31, 9], 'diff_bid_vol': [-4, 0, -5, 4, -1], 'ask_price': ['14935', '14936', '14937', '14938', '14939'], 'ask_volume': [5, 8, 8, 11, 12], 'diff_ask_vol': [3, 3, 0, 0, 0], 'first_derived_bid_price': '0', 'first_derived_ask_price': '14939', 'first_derived_bid_vol': 0, 'first_derived_ask_vol': 1, 'underlying_price': '15176.44', 'simtrade': 0}
# {'code': 'TXFG2', 'datetime': '2022-06-23T21:52:32.407000', 'open': '14904', 'underlying_price': '15176.44', 'bid_side_total_vol': 29991, 'ask_side_total_vol': 29864, 'avg_price': '14949.592158', 'close': '14934', 'high': '15041', 'low': '14849', 'amount': '29868', 'total_amount': '695828767', 'volume': 2, 'total_volume': 46545, 'tick_type': 2, 'chg_type': 4, 'price_chg': '-5', 'pct_chg': '-0.033469', 'simtrade': 0}


def fop_tick_callback_v1(exchange: Exchange, tick: TickFOPv1):
    # print(f'fop_tick_callback_v1: {exchange} {tick}')
    print(tick.to_dict(raw=True))


def fop_bidask_callback_v1(exchange: Exchange, bidask: BidAskFOPv1):
    # print(f'fop_bidask_callback_v1: {exchange} {bidask}')
    print(bidask.to_dict(raw=True))


api.set_order_callback(order_callback)
api.quote.set_event_callback(event_callback)
api.quote.set_quote_callback(quote_callback)
api.quote.set_on_tick_stk_v1_callback(stk_tick_callback_v1)
api.quote.set_on_bidask_stk_v1_callback(stk_bidask_callback_v1)
api.quote.set_on_tick_fop_v1_callback(fop_tick_callback_v1)
api.quote.set_on_bidask_fop_v1_callback(fop_bidask_callback_v1)
</code></pre>
<pre><code class="language-python">if timestamp.time() &lt; datetime.time(13, 25, 0):
    # æœ€å¾Œä¸€ç›¤ 13:25:00 å‰ä¸‹å›è£œå–®ã€‚ä¸€ç‡å¸‚åƒ¹å–®å›è£œ
    self.order_cover = sdt.api.Order(
        price=0,
        quantity=current_number_to_cover,
        action="Buy",
        price_type="MKT",
        order_type="ROD",
        order_lot="Common",
        first_sell="false",
        account=sdt.api.stock_account,
    )
else:
    # 13:25 å¾Œå›è£œï¼Œæœ€å¾Œä¸€ç›¤ï¼Œåªèƒ½ç”¨ï¼šé™åƒ¹ï¼‹æ¼²åœåƒ¹æ ¼ ä¾†ç¢ºä¿ä¸€å®šæœƒè£œå›ä¾†
    self.order_cover = sdt.api.Order(
        price=self.today_limit_up,
        quantity=current_number_to_cover,
        action="Buy",
        price_type="LMT",
        order_type="ROD",
        order_lot="Common",
        first_sell="false",
        account=sdt.api.stock_account,
    )

# ä¸‹é™åƒ¹å–® æˆ–æ˜¯ ä¸‹å¸‚åƒ¹å–®
if sdt.config[w.order_setting][w.order_limited] == w.Yes:
    self.order_put = sdt.api.Order(
        price=self.today_put_order_price,
        quantity=abs(units),
        action="Sell",
        price_type="LMT",
        order_type="ROD",
        order_lot="Common",
        first_sell="true",
        account=sdt.api.stock_account,
    )
else:
    self.order_put = sdt.api.Order(
        price=0,
        quantity=abs(units),
        action="Sell",
        price_type="MKT",
        order_type="ROD",
        order_lot="Common",
        first_sell="true",
        account=sdt.api.stock_account,
    )

self.trade_put = sdt.place_order(self.__contract__, self.order_put)

</code></pre>
<h2 id="apiactivate_ca-å•Ÿå‹•é›»å­æ†‘è­‰"><a class="header" href="#apiactivate_ca-å•Ÿå‹•é›»å­æ†‘è­‰">api.activate_ca å•Ÿå‹•é›»å­æ†‘è­‰</a></h2>
<p>å®˜æ–¹èªªæ˜æ–‡ä»¶ï¼š
https://sinotrade.github.io/tutor/order/CA/
åœ¨ä¸‹å–®ä¹‹å‰ï¼Œéœ€è¦å…ˆä¸‹è¼‰æ°¸è±è­‰åˆ¸å¸³æˆ¶çš„ä¸‹å–®é›»å­æ†‘è­‰ï¼Œä¸‹è¼‰æ–¹å¼è«‹åƒè€ƒå®˜æ–¹èªªæ˜
https://www.sinotrade.com.tw/CSCenter/CSCenter_13_1?tab=2
ä¸‹è¼‰å®Œæˆå¾Œï¼Œå¯ä»¥é€éapi.activate_caä¾†å•Ÿç”¨ä¸‹å–®é›»å­æ†‘è­‰ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">from dotenv import load_dotenv
import os
import shioaji as sj

load_dotenv('D:\\python\\shioaji\\.env') #è®€å–.envä¸­çš„ç’°å¢ƒè®Šæ•¸
api = sj.Shioaji()
api.login(
    person_id=os.getenv('YOUR_PERSON_ID'), 
    passwd=os.getenv('YOUR_PASSWORD')
)

result = api.activate_ca(
    ca_path=os.getenv('YOUR_CA_PATH'), # ä¸‹å–®é›»å­æ†‘è­‰è·¯å¾‘åŠæª”æ¡ˆåç¨±
    ca_passwd=os.getenv('YOUR_CA_PASS'), # ä¸‹å–®é›»å­æ†‘è­‰å¯†ç¢¼
    person_id=os.getenv('YOUR_PERSON_ID'), # èº«ä»½è­‰å­—è™Ÿ
)
print(result)

api.logout()
</code></pre>
<h2 id="ä¸‹å–®é›»å­æ†‘è­‰åŠstockè‚¡ç¥¨orderå»ºç«‹"><a class="header" href="#ä¸‹å–®é›»å­æ†‘è­‰åŠstockè‚¡ç¥¨orderå»ºç«‹">ä¸‹å–®é›»å­æ†‘è­‰åŠStockè‚¡ç¥¨Orderå»ºç«‹</a></h2>
<p>å‡ºè™• ï¼š https://ithelp.ithome.com.tw/articles/10272506?sc=iThelpR</p>
<p>å•Ÿç”¨ä¸‹å–®é›»å­æ†‘è­‰å‰è¦å…ˆåŸ·è¡Œapi.loginé€²è¡Œç™»å…¥ã€‚åœ¨é€™è£¡ä¸€æ¨£æŠŠé›»å­æ†‘è­‰ç›¸é—œè³‡è¨Šå…ˆå„²å­˜åœ¨envæª”æ¡ˆä¸­ï¼Œå†é€éos.getenv()å–å¾—è³‡è¨Šä¸¦å‚³å…¥activate_caä¸­ï¼Œè‹¥é›»å­æ†‘è­‰å•Ÿç”¨æˆåŠŸï¼Œå‰‡å›å‚³çš„resultå°±æœƒæ˜¯Trueã€‚</p>
<blockquote>
<p>è‹¥ä½ è¦ç”¨è™›æ“¬å¸³æˆ¶ç™»å…¥ä¸¦ç·´ç¿’æˆ–æ¸¬è©¦ä¸‹å–®åŠŸèƒ½ï¼Œä¸å¿…å•Ÿå‹•é›»å­æ†‘è­‰ï¼Œå¯è·³éé€™å€‹æ­¥é©Ÿã€‚</p>
</blockquote>
<h2 id="orderç‰©ä»¶å»ºç«‹èªªæ˜"><a class="header" href="#orderç‰©ä»¶å»ºç«‹èªªæ˜">Orderç‰©ä»¶å»ºç«‹èªªæ˜</a></h2>
<p>å®˜æ–¹èªªæ˜æ–‡ä»¶ï¼šhttps://sinotrade.github.io/tutor/order/Stock/#making-order-object
åœ¨ç™¼é€å§”è¨—å–®å‰ï¼Œè¦å…ˆç”¢ç”Ÿä¸€å€‹Orderç‰©ä»¶ã€‚
Orderç‰©ä»¶å»ºç«‹çš„åƒæ•¸èªªæ˜å¦‚ä¸‹ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">åƒæ•¸</th><th style="text-align: center">åƒæ•¸èªªæ˜</th><th style="text-align: center">åƒæ•¸ç¯„ä¾‹</th></tr></thead><tbody>
<tr><td style="text-align: center">price</td><td style="text-align: center">å§”è¨—åƒ¹æ ¼</td><td style="text-align: center">18.5</td></tr>
<tr><td style="text-align: center">quantity</td><td style="text-align: center">å§”è¨—æ•¸é‡</td><td style="text-align: center">1</td></tr>
<tr><td style="text-align: center">action</td><td style="text-align: center">å§”è¨—å–®å‹•ä½œ</td><td style="text-align: center">{Buy, Sell}</td></tr>
<tr><td style="text-align: center">price_type</td><td style="text-align: center">åƒ¹æ ¼é¡å‹</td><td style="text-align: center">{LMT, MKT, MKP} (é™åƒ¹ã€å¸‚åƒ¹ã€ç¯„åœå¸‚åƒ¹)</td></tr>
<tr><td style="text-align: center">order_type</td><td style="text-align: center">å§”è¨—å–®é¡å‹</td><td style="text-align: center">{ROD, IOC, FOK} (ç•¶æ—¥æœ‰æ•ˆã€ç«‹å³æˆäº¤å¦å‰‡å–æ¶ˆã€å…¨éƒ¨æˆäº¤å¦å‰‡å–æ¶ˆ)</td></tr>
<tr><td style="text-align: center">order_cond</td><td style="text-align: center">å§”è¨—å–®ç¨®é¡</td><td style="text-align: center">{Cash, MarginTrading, ShortSelling} (ç¾è‚¡ã€èè³‡ã€èåˆ¸)</td></tr>
<tr><td style="text-align: center">order_lot</td><td style="text-align: center">å§”è¨—å–®äº¤æ˜“å–®ä½</td><td style="text-align: center">{Common, Fixing, Odd, IntradayOdd} (æ•´è‚¡ã€ç›¤å¾Œå®šåƒ¹ã€ç›¤å¾Œé›¶è‚¡ã€ç›¤ä¸­é›¶è‚¡)</td></tr>
<tr><td style="text-align: center">first_sell</td><td style="text-align: center">æ˜¯å¦ç‚ºç¾æ²–å…ˆè³£</td><td style="text-align: center">{true, false}</td></tr>
<tr><td style="text-align: center">octype</td><td style="text-align: center">å€‰åˆ¥</td><td style="text-align: center">{Auto, NewPosition, Cover, DayTrade} (è‡ªå‹•ã€æ–°å€‰ã€å¹³å€‰ã€ç•¶æ²–)</td></tr>
<tr><td style="text-align: center">OptionRight</td><td style="text-align: center">é¸æ“‡æ¬Šé¡åˆ¥</td><td style="text-align: center">{Call, Put}</td></tr>
<tr><td style="text-align: center">account</td><td style="text-align: center">äº¤æ˜“å¸³æˆ¶</td><td style="text-align: center">å¯ç”±APIå–å¾—accountç‰©ä»¶</td></tr>
</tbody></table>
</div>
<blockquote>
<p>order_condã€order_lotåŠfirst_sellï¼Œç‚ºè‚¡ç¥¨Orderç‰©ä»¶ç‰¹æœ‰å±¬æ€§
octypeï¼Œç‚ºæœŸè²¨æˆ–é¸æ“‡æ¬ŠOrderç‰©ä»¶ç‰¹æœ‰å±¬æ€§
OptionRightç‚ºé¸æ“‡æ¬ŠOrderç‰©ä»¶ç‰¹æœ‰å±¬æ€§</p>
</blockquote>
<h3 id="ç¾è‚¡è²·é€²orderç¯„ä¾‹"><a class="header" href="#ç¾è‚¡è²·é€²orderç¯„ä¾‹">ç¾è‚¡è²·é€²ï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Buy, #è²·é€²
    price_type=sj.constant.StockPriceType.LMT, 
    order_type=sj.constant.TFTOrderType.ROD, 
    order_lot=sj.constant.TFTStockOrderLot.Common, 
    account=api.stock_account
)
</code></pre>
<h3 id="ç¾è‚¡è³£å‡ºorderç¯„ä¾‹"><a class="header" href="#ç¾è‚¡è³£å‡ºorderç¯„ä¾‹">ç¾è‚¡è³£å‡ºï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Sell, #è³£å‡º
    price_type=sj.constant.StockPriceType.LMT, 
    order_type=sj.constant.TFTOrderType.ROD, 
    order_lot=sj.constant.TFTStockOrderLot.Common, 
    account=api.stock_account
)
</code></pre>
<h3 id="ç¾æ²–å…ˆè³£orderç¯„ä¾‹"><a class="header" href="#ç¾æ²–å…ˆè³£orderç¯„ä¾‹">ç¾æ²–å…ˆè³£ï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Sell,
    price_type=sj.constant.StockPriceType.LMT,
    order_type=sj.constant.TFTOrderType.ROD,
    order_lot=sj.constant.TFTStockOrderLot.Common,
    first_sell=sj.constant.StockFirstSell.Yes, #ç¾æ²–å…ˆè³£ï¼Œè¨­å®šç‚ºStockFirstSell.Yes or True
    account=api.stock_account
)
</code></pre>
<h3 id="ç›¤ä¸­é›¶è‚¡orderç¯„ä¾‹"><a class="header" href="#ç›¤ä¸­é›¶è‚¡orderç¯„ä¾‹">ç›¤ä¸­é›¶è‚¡ï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Buy, #è²·é€²
    price_type=sj.constant.StockPriceType.LMT, 
    order_type=sj.constant.TFTOrderType.ROD, 
    order_lot=sj.constant.TFTStockOrderLot.IntradayOdd, #æŒ‡å®šç›¤ä¸­é›¶è‚¡
    account=api.stock_account
)
</code></pre>
<h3 id="ç›¤ä¸­é›¶è‚¡orderç¯„ä¾‹-1"><a class="header" href="#ç›¤ä¸­é›¶è‚¡orderç¯„ä¾‹-1">ç›¤ä¸­é›¶è‚¡ï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Buy, #è²·é€²
    price_type=sj.constant.StockPriceType.LMT, 
    order_type=sj.constant.TFTOrderType.ROD, 
    order_lot=sj.constant.TFTStockOrderLot.IntradayOdd, #æŒ‡å®šç›¤ä¸­é›¶è‚¡
    account=api.stock_account
)
</code></pre>
<h3 id="ç›¤å¾Œå®šåƒ¹orderç¯„ä¾‹"><a class="header" href="#ç›¤å¾Œå®šåƒ¹orderç¯„ä¾‹">ç›¤å¾Œå®šåƒ¹ï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Buy, #è²·é€²
    price_type=sj.constant.StockPriceType.LMT, 
    order_type=sj.constant.TFTOrderType.ROD, 
    order_lot=sj.constant.TFTStockOrderLot.Fixing, #æŒ‡å®šç›¤å¾Œå®šåƒ¹
    account=api.stock_account
)
</code></pre>
<h3 id="ç›¤å¾Œé›¶è‚¡orderç¯„ä¾‹"><a class="header" href="#ç›¤å¾Œé›¶è‚¡orderç¯„ä¾‹">ç›¤å¾Œé›¶è‚¡ï¼ŒOrderç¯„ä¾‹</a></h3>
<pre><code class="language-python">order = api.Order(
    price=12, 
    quantity=1, 
    action=sj.constant.Action.Buy, #è²·é€²
    price_type=sj.constant.StockPriceType.LMT, 
    order_type=sj.constant.TFTOrderType.ROD, 
    order_lot=sj.constant.TFTStockOrderLot.Odd, #æŒ‡å®šç›¤å¾Œé›¶è‚¡
    account=api.stock_account
)
</code></pre>
<p>ä»¥ä¸Šç‚ºç¾è‚¡Orderçš„å»ºç«‹åŠä¸‹å–®ç›¸é—œæ“ä½œï¼Œè‹¥æ˜¯è¦ä½¿ç”¨èè³‡æˆ–èåˆ¸ï¼Œåªè¦åœ¨å»ºç«‹Orderæ™‚æŒ‡å®šorder_condç‚ºStockOrderCond.MarginTrading(èè³‡)æˆ–æ˜¯StockOrderCond.ShortSelling(èåˆ¸)å³å¯ï¼›è‹¥åœ¨å»ºç«‹Orderæ™‚æ²’æœ‰æŒ‡å®šorder_condï¼Œé è¨­éƒ½æ˜¯ä»¥StockOrderCond.Cashå»ºç«‹ã€‚</p>
<hr />
<pre><code class="language-python">from Jlab.watcher import Watcher
import shioaji as sj
import json
import os
import sys


def login(simulation=False):
    api = sj.Shioaji(simulation=simulation)
    token_file = os.environ["HOME"] + "/.mybin/shioaji_tokens.json"
    with open(token_file, "r") as f:
        users = json.load(f)
        print("All users: " + ", ".join(users.keys()))

        user = input("Select a user from the list above: ")
        if user not in users:
            print("User not found.")
            sys.exit()

        api.login(
            users[user]["api_key"], users[user]["secret_key"], fetch_contract=False
        )
        api.fetch_contracts(contract_download=True)
        print(f"Logged in as {user}")
        return api


def get_near_month_txf_contract(api):
    contract = min(
        [x for x in api.Contracts.Futures.TXF if x.code[-2:] not in ["R1", "R2"]],
        key=lambda x: x.delivery_date,
    )
    return contract


def simulation(api):
    contract = api.Contracts.Stocks.TSE["2890"]
    # order - edit it
    order = api.Order(
        action=sj.constant.Action.Buy,
        price=20,
        quantity=1,
        price_type=sj.constant.StockPriceType.LMT,
        order_type=sj.constant.OrderType.ROD,
        account=api.stock_account,
    )

    # place order
    trade = api.place_order(contract, order, timeout=0)
    print(trade)


if __name__ == "__main__":
    Watcher()
    # è¨­ç½®åƒæ•¸ä»¥æ±ºå®šæ˜¯ä½¿ç”¨æ¨¡æ“¬é‚„æ˜¯å¯¦éš›äº¤æ˜“
    SIMULATION = False
    api = login(simulation=SIMULATION)
    if SIMULATION:
        simulation(api)
    else:
        contract = get_near_month_txf_contract(api)
        print(contract)

        # print(api.account_balance())
        # print(api.list_positions(api.stock_account))
        contracts = [api.Contracts.Stocks["2330"], api.Contracts.Stocks["2317"]]
        snapshots = api.snapshots(contracts)
        print(snapshots)
        # Stock default account  è­‰åˆ¸ç›®å‰çš„é è¨­å¸³æˆ¶
    print(api.stock_account)

    # Futures default account æœŸè²¨ç›®å‰çš„é è¨­å¸³æˆ¶
    print(api.futopt_account)

    api.logout()
</code></pre>
<hr />
<pre><code class="language-python">accounts = api.list_accounts()
</code></pre>
<p>è‹¥ä½ ç™»å…¥è™›æ“¬ç’°å¢ƒå¾Œï¼ŒåŸ·è¡Œprint(accounts)ï¼Œæœƒé¡¯ç¤ºä»¥ä¸‹å…§å®¹</p>
<pre><code>[FutureAccount(person_id='QBCCAIGJBJ', broker_id='F002000', account_id='9100020', signed=True, username='PAPIUSER01'), StockAccount(person_id='QBCCAIGJBJ', broker_id='9A95', account_id='0504350', signed=True, username='PAPIUSER01')]
</code></pre>
<p>å¯ä»¥çœ‹åˆ°è™›æ“¬ç’°å¢ƒå¸³è™Ÿåº•ä¸‹ï¼Œåˆ†åˆ¥æœ‰FutureAccountæœŸè²¨å¸³æˆ¶åŠStockAccountè‚¡ç¥¨å¸³æˆ¶ï¼Œç›¸é—œè®Šæ•¸èªªæ˜å¦‚ä¸‹ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">è®Šæ•¸åç¨±</th><th style="text-align: left">èªªæ˜</th><th style="text-align: left"></th></tr></thead><tbody>
<tr><td style="text-align: left">person_id</td><td style="text-align: left">èº«ä»½è­‰è™Ÿç¢¼</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">broker_id</td><td style="text-align: left">åˆ¸å•†åˆ†é»è™Ÿç¢¼</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">account_id</td><td style="text-align: left">å¸³æˆ¶è™Ÿç¢¼</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left"><strong>signed</strong></td><td style="text-align: left">æ˜¯å¦å·²ç°½ç½²APIä¸‹å–®</td><td style="text-align: left">è‹¥å¸³è™Ÿè³‡è¨Šç„¡æ­¤è®Šæ•¸ï¼Œè¡¨ç¤ºæ­¤å¸³æˆ¶å°šæœªç°½ç½²APIä¸‹å–®</td></tr>
<tr><td style="text-align: left">username</td><td style="text-align: left">ä½¿ç”¨è€…åç¨±</td><td style="text-align: left">è‹¥ä½¿ç”¨å€‹äººå¸³è™Ÿç™»å…¥ï¼Œæ­¤æ¬„ä½é¡¯ç¤ºä½ çš„å§“å</td></tr>
</tbody></table>
</div>
<p>è‹¥ä½ çš„å¸³æˆ¶å°šæœªç°½ç½²APIä¸‹å–®ï¼Œå¯é–‹å•Ÿæ°¸è±é‡‘iLeaderï¼Œæ‰¾åˆ°ã€Œæ•¸ä½eæ«ƒè‡ºã€ä¸¦é–‹å•Ÿ</p>
<p>https://github.com/eyelash500/2021_ironman_Shioaji</p>
<pre><code class="language-py">import threading
import time
from datetime import datetime

import shioaji as sj


class trader:
    """The Shioaji Object"""

    def __init__(self) -&gt; None:
        self.simulation = True  # æ˜¯å¦ç‚ºæ¸¬è©¦ç’°å¢ƒ
        self.id = "PAPIUSER07"
        self.pwd = "2222"
        self.api = sj.Shioaji()
        self.diff = 0  # å¤§è‡ºçš„é»æ•¸å·®

    def login(self, id=None, pwd=None, simulation=True):
        """Login to Shioaji.
        Args:
            id(str): user ID
            pwd(str): the login password
        Returns:
            bool: True is login successfully, False is not.
        """

        print(f"=start login-{datetime.now().strftime('%Y%m%d')}")
        if id and pwd:
            self.id = id
            self.pwd = pwd

        try:
            # ç™»å…¥ shioaji
            self.api = sj.Shioaji(simulation=simulation)
            self.api.login(person_id=self.id, passwd=self.pwd)
        except Exception as exc:
            print(f"id={self.id}, pwd={self.pwd}...{exc}")
            return False

        return True

    def _get_subscribe(self) -&gt; bool:
        """Get the subscibe format."""

        print(self.api.quote.subscribe)

        return True

    def subscribe(self, contract):
        """subscribe the contract quote."""

        print("=Subscribe=")
        self.api.quote.subscribe(contract, quote_type=sj.constant.QuoteType.Tick)

    def unsubscribe(self, contract):
        """unsubscribe the contract."""

        print("unsubscribe")
        self.api.quote.unsubscribe(contract, quote_type=sj.constant.QuoteType.Tick)

    def quote_callback(self, topic: str, quote: dict):
        """Get the quote info and change the oder price.
        The quote's format is v0: quote is a dict and the value is a list.
        """

        print(
            f"{topic}-Price:[{quote['Close']}]Diff:[{quote['DiffPrice']}]volumn:[{quote['Volume']}]"
        )

        if topic.find("TFE/TXF") &gt; 0:
            self.diff = quote["DiffPrice"][0]
        elif topic.find("OPT/TX") &gt; 0:
            reduced_point = 1

            # è¨­å®šè¦æ¸›å°‘çš„é»æ•¸
            if self.diff &lt; quote["Close"][0]:
                reduced_point = self.diff  # æ¯”å¸‚åƒ¹é‚„è¦ä½çš„æ•¸å­—
            else:
                # ç•¶è®Šå‹•å¾ˆå¤šæ™‚ï¼Œè¦å‰ªå»çš„åƒ¹æ ¼æœƒæ¯”è¼ƒå¤§ï¼Œä½†æ¯”ç¾åƒ¹é‚„è¦å°
                reduced_point = quote["Close"][0] - reduced_point

            self.change_price(quote["Close"], True, reduced_point)  # åƒ¹æ ¼æ¯”ç¾åƒ¹é‚„è¦ä½ï¼Œ

    def change_price(self, price, diff, points):
        """Simulate to change the price of the order."""

        self.mxf_price = price[0] - points if diff else price[0] + points
        print(f"é¸æ“‡æ¬Šï¼šcurrent price:{price[0]}-new price:{self.mxf_price}")


def sleeper():
    """For sleeping... Let us get the quote and change the price."""

    print("-start sleep...")
    time.sleep(60)
    print("-Wake up!!!!")


timer = threading.Thread(target=sleeper)  # å»ºç«‹åŸ·è¡Œç·’

t = trader()
t.login()

t.subscribe(t.api.Contracts.Futures.TXF["TXF202110"])  # è¨‚é–±è‡ºæŒ‡æœŸ-2021/10
t.subscribe(t.api.Contracts.Options.TX2.TX2202110016300C)  # è¨‚é–±è‡ºæŒ‡é¸æ“‡æ¬Š10W2æœˆ 16300C

t.api.quote.set_quote_callback(t.quote_callback)  # è¨­å®šè™•ç†å›å ±çš„åŠŸèƒ½

timer.start()  # åŸ·è¡Œthread
timer.join()  # ç­‰å¾…çµæŸthread

t.unsubscribe(t.api.Contracts.Futures.TXF["TXF202110"])  # å–æ¶ˆè¨‚é–±è‡ºæŒ‡æœŸ-2021/10
t.unsubscribe(t.api.Contracts.Options.TX2.TX2202110016300C)  # å–æ¶ˆè¨‚é–±è‡ºæŒ‡é¸æ“‡æ¬Š10W2æœˆ 16300C
</code></pre>
<ul>
<li><a href="https://gist.github.com/ypochien/ecc4abb7e18d21fc988c75a09e4df6e4#file-positionaid-py"><strong>PositionAid.py</strong></a></li>
<li>https://gist.github.com/ypochien</li>
</ul>
<pre><code class="language-py"># å…ˆé€é createPositionFromPnl å»ºç«‹ç•¶ä¸‹éƒ¨ä½ç‹€æ…‹ï¼Œå¾Œé¢é€é Shioaji æˆäº¤å›å ± å³æ™‚æ›´æ–°è‚¡ç¥¨æŒå€‰éƒ¨ä½

from loguru import logger
from dataclasses import dataclass
from typing import Optional, Dict, List
import math
import shioaji as sj
from shioaji.constant import OrderState, Action, StockOrderCond


@dataclass
class StockPosition:
    symbol: str
    action: Action
    quantity: int
    cost: int
    ordercond: StockOrderCond


class PositionAid:
    def __init__(self, api: sj.Shioaji):
        self.api = api
        self.api.set_order_callback(self.onOrderStatusChange)
        self.position: Dict[str, StockPosition] = {}

    def onOrderStatusChange(self, state: OrderState, data: Dict):
        if state == OrderState.TFTOrder:
            pass
        elif state == OrderState.TFTDeal:
            self.updatePosition(data)

    def createPositionFromPnl(self):
        """
        å¾ api list_position æç›Šå»ºç«‹ Position è³‡è¨Š
        """
        all_pnl = self.api.list_positions()
        for pnl in all_pnl:
            position = StockPosition(
                symbol=pnl.code,
                action=pnl.direction,
                quantity=pnl.quantity,
                cost=math.floor(pnl.price * pnl.quantity * 1000),
                ordercond=pnl.cond,
            )
            self.position[position.symbol] = position

    def getAllPosition(self) -&gt; List[StockPosition]:
        return list(self.position.values())

    def updatePosition(self, deal: Dict):
        code = deal["code"]
        action = deal["action"]
        order_cond = deal["order_cond"]
        quantity = deal["quantity"]
        cost = math.floor(deal["price"] * deal["quantity"] * 1000)

        position = self.getPosition(code)
        if position == None:
            position = StockPosition(
                symbol=code,
                action=action,
                quantity=quantity,
                cost=cost,
                ordercond=order_cond,
            )
        else:
            if position.action == action:
                position.quantity += quantity
                position.cost += cost
            else:
                position.quantity -= quantity
                position.cost -= cost
        self.position[code] = position
        logger.info(
            f"{code} {self.api.Contracts.Stocks[code].name} {action} {deal['price']} å…ƒ {quantity}å¼µ  -&gt; {position}"
        )

    def getPosition(self, code: str) -&gt; Optional[StockPosition]:
        """code: è‚¡ç¥¨ä»£ç¢¼
        é€é è‚¡ç¥¨ä»£ç¢¼ å–å¾— StockPosition è³‡è¨Š
        æ²’æœ‰æ­¤æª”è‚¡ç¥¨ å‰‡å›å‚³ = None
        """
        return self.position.get(code, None)


if __name__ == "__main__":
    # å»ºç«‹ Shioaji ä¸¦ç™»å…¥
    api = sj.Shioaji() 
    api.login("SJ_USER","SJ_PASSWORD")

    # å»ºç«‹ PositionAid
    aid = PositionAid(api) # è‡ªå‹•æ¥æ‰‹ SJ ä¸»å‹•å›å ± ä¸¦è™•ç† æˆäº¤è³‡è¨Š
    aid.createPositionFromPnl() # å¾ api list_position æç›Šå»ºç«‹ Position è³‡è¨Š
    
    aid.getPosition("2330") # å–å¾— 2330 æŒå€‰è³‡è¨Š (å¦‚æœæ²’æœ‰ 2330 å‰‡å¾—åˆ° None)

</code></pre>
<p><a href="https://gist.github.com/ypochien/272f062d249e057322afbd6db0b51dce#file-cancelallorder-py"><strong>CancelAllOrder.py</strong></a></p>
<pre><code class="language-py"># åˆªé™¤å…¨éƒ¨çš„å§”è¨—å–®
api.update_status()
for idx,t in enumerate(api.list_trades()):
    if t.status.status in [shioaji.constant.Status.PreSubmitted,shioaji.constant.Status.Submitted,shioaji.constant.Status.PartFilled] :
        api.cancel_order(t,timeout=0)
</code></pre>
<p><a href="https://gist.github.com/ypochien/d0236f4b9b89bf74a392118066d40d4c"><strong>clear_all.py</strong></a></p>
<pre><code class="language-py"># 13:25ä¹‹å¾Œç”¨æ¼²è·Œåœåƒ¹æ ¼åå‘å‡ºå ´
def clear_all():
    """13:25ä¹‹å¾Œç”¨æ¼²è·Œåœåƒ¹æ ¼åå‘å‡ºå ´"""
    #åªè™•ç†ä»Šå¤©æ–°å¢çš„ç¾è‚¡ (ç¾è‚¡ç•¶æ²–ã€ä¸å«èˆˆæ«ƒ)
    pnls = [one for one in api.list_positions() if abs(one.quantity) - one.yd_quantity!=0]
    for one_pnl in pnls:
        contract = api.Contracts.Stocks[one_pnl.code]
        if contract == None:
            print(f"ç„¡æ­¤å•†å“ {one_pnl.code}")
            continue
        action = "Buy"
        price = contract.limit_up
        if one_pnl.direction=='Buy':
            action = "Sell"
            price = contract.limit_down
        quantity = abs(one_pnl.quantity) - one_pnl.yd_quantity
        if quantity &gt; 0 and contract.exchange!="OES":
            order = api.Order(price=price, quantity=quantity, action=action, price_type="LMT", order_type="ROD", order_lot="Common",first_sell="false")
            for _ in range(0,quantity // 499):
                order.quantity = 499
                api.place_order(api.Contracts.Stocks[one_pnl.code],order)
                print(f"{one_pnl.code} {[pnl.pnl for pnl in pnls if pnl.code==one_pnl.code]} {order.action.value} {order.quantity} å¼µ {order.price} å…ƒ")
            left = quantity % 499
            if left &gt; 0:
                order.quantity = left
                api.place_order(api.Contracts.Stocks[one_pnl.code],order)
                print(f"{one_pnl.code} {[pnl.pnl for pnl in pnls if pnl.code==one_pnl.code]} {order.action.value} {order.quantity} å¼µ {order.price} å…ƒ")
</code></pre>
<p><a href="https://ithelp.ithome.com.tw/users/20140938/ironman/4335">æ°¸è±é‡‘APIä¹‹30å¤©ä¸ä¸­æ–·Q&amp;A ç³»åˆ—</a></p>

                        <script src="https://utteranc.es/client.js"
                            repo="imxood/imxood.github.io"
                            issue-term="pathname"
                            theme="boxy-light"
                            crossorigin="anonymous"
                            async>
                        </script>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../python/plot.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../python/other.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../python/plot.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../python/other.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../theme/custom/mermaid.min.js"></script>
        <script type="text/javascript" src="../theme/custom/mermaid-init.js"></script>


    </body>
</html>
